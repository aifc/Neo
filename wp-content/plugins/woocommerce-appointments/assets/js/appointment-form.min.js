jQuery(document).ready(function(a){"use strict";var b=[],c={init:function(){"day"===wc_appointment_form_params.duration_unit?a(".wc-appointments-appointment-form").parents("form").on("staff-selected",this.calculate_costs).on("date-selected",this.calculate_costs).each(this.appointment_form_init):a(".wc-appointments-appointment-form").parents("form").on("staff-selected",this.calculate_costs).on("time-selected",this.calculate_costs).each(this.appointment_form_init),a(".wc-appointments-appointment-hook").on("change","input, select",this.calculate_costs),a(".quantity").on("change","input, select",this.calculate_costs),a(".wc-appointments-appointment-form, .wc-appointments-appointment-form-button").show().removeAttr("disabled"),a(".single_add_to_cart_button").on("click",this.add_to_cart_init)},appointment_form_init:function(){a(this).find(".single_add_to_cart_button").addClass("disabled")},add_to_cart_init:function(b){return a(this).hasClass("disabled")?(window.alert(wc_appointment_form_params.i18n_choose_options),b.preventDefault(),!1):void 0},calculate_costs:function(){var d=a(this).attr("name"),e=a(this).closest("form"),f=e.find("input.required_for_calculation"),g=!0,h=e.find("fieldset"),i=h.find(".picker:eq(0)"),j=e.index();if(!i.data("is_range_picker_enabled")||"wc_appointments_field_duration"===d){if(b[j]&&b[j].abort(),a.each(f,function(b,c){var d=a(c).val();d||(g=!1)}),!g)return e.find(".wc-appointments-appointment-cost").hide(),void e.find(".wc-appointments-appointment-hook").hide();e.find(".wc-appointments-appointment-cost").block({message:null,overlayCSS:{background:"#fff",backgroundSize:"16px 16px",opacity:.6}}).show(),b[j]=a.ajax({type:"POST",url:wc_appointment_form_params.ajax_url,data:{action:"wc_appointments_calculate_costs",form:e.serialize()},success:function(b){"{"!==b.charAt(0)&&(b="{"+b.split(/\{(.+)?/)[1]);var d=a.parseJSON(b);"ERROR"===d.result?(e.find(".wc-appointments-appointment-cost").html(d.html),e.find(".wc-appointments-appointment-cost").unblock(),e.find(".single_add_to_cart_button").addClass("disabled")):"SUCCESS"===d.result?(e.find(".wc-appointments-appointment-cost").html(d.html),e.find(".wc-appointments-appointment-cost").unblock(),e.find(".wc-appointments-appointment-hook").show(),e.find(".single_add_to_cart_button").removeClass("disabled"),wc_appointment_form_params.is_admin||c.update_querystring_date_time(e)):(e.find(".wc-appointments-appointment-cost").hide(),e.find(".wc-appointments-appointment-hook").hide(),e.find(".single_add_to_cart_button").addClass("disabled"))},error:function(){e.find(".wc-appointments-appointment-cost").hide(),e.find(".single_add_to_cart_button").addClass("disabled")},dataType:"html"})}},update_querystring_date_time:function(a){if(window.history&&window.history.pushState){var b=a.find("input.appointment_date_year").val(),d=a.find("input.appointment_date_month").val(),e=a.find("input.appointment_date_day").val(),f=a.find("#wc_appointments_field_start_date"),g=b+"-"+d+"-"+e,h=window.location.href,i=c.replace_url_parameter("date",g,h);f.length>0&&""!==f.val()?(i=c.replace_url_parameter("time",f.val(),i),window.history.replaceState({date:g,time:f.val()},null,i)):window.history.replaceState({date:g,time:null},null,i)}},replace_url_parameter:function(a,b,c){var d=c.match(/[a-z\d]+=[a-z\d]+/gi),e=d?d.length:0;if(null===get_querystring(a))c+=(e>0?"&":"?")+a+"="+encodeURIComponent(b);else{var f=new RegExp("("+a+"=)[^&]+");c=c.replace(f,"$1"+encodeURIComponent(b))}return c}};c.init()});