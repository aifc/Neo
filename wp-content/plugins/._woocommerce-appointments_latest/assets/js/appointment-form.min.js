function get_querystring(a){"use strict";a=a.replace(/[*+?^$.\[\]{}()|\\\/]/g,"\\$&");var b=location.search.match(new RegExp("[?&]"+a+"=([^&]+)(&|$)"));return b&&decodeURIComponent(b[1].replace(/\+/g," "))}function is_valid_date(a){"use strict";var b=a.split("-"),c=parseInt(b[0],10),d=parseInt(b[1],10),e=parseInt(b[2],10),f=new Date(c,d-1,e);return c===f.getFullYear()&&d===f.getMonth()+1&&e===f.getDate()}jQuery(document).ready(function(a){"use strict";var b=[],c={init:function(){"day"===wc_appointment_form_params.duration_unit?a(".wc-appointments-appointment-form").parents("form").on("staff-selected",this.calculate_costs).on("date-selected",this.calculate_costs).each(this.appointment_form_init):a(".wc-appointments-appointment-form").parents("form").on("time-selected",this.calculate_costs).each(this.appointment_form_init),a(".wc-appointments-appointment-hook").on("change","input, select",this.calculate_costs),a(".quantity").on("change","input, select",this.calculate_costs),a(".wc-appointments-appointment-form, .wc-appointments-appointment-form-button").show().removeAttr("disabled"),a(".single_add_to_cart_button").on("click",this.add_to_cart_init)},appointment_form_init:function(){a(this).find(".single_add_to_cart_button").addClass("disabled")},add_to_cart_init:function(b){if(a(this).hasClass("disabled"))return window.alert(wc_appointment_form_params.i18n_choose_options),b.preventDefault(),!1},calculate_costs:function(){var d=a(this).attr("name"),e=a(this).closest("form"),f=e.find("input.required_for_calculation"),g=!0,h=e.find("fieldset"),i=h.find(".picker:eq(0)"),j=e.index();if(!i.data("is_range_picker_enabled")||"wc_appointments_field_duration"===d){if(a.each(f,function(b,c){a(c).val()||(g=!1)}),!g)return e.find(".wc-appointments-appointment-cost").hide(),void e.find(".wc-appointments-appointment-hook").hide();e.find(".wc-appointments-appointment-cost").block({message:null,overlayCSS:{background:"#fff",backgroundSize:"16px 16px",opacity:.6}}).show(),e.find(".single_add_to_cart_button").addClass("disabled"),b[j]=a.ajax({type:"POST",url:wc_appointment_form_params.ajax_url,data:{action:"wc_appointments_calculate_costs",form:e.serialize()},success:function(b){"{"!==b.charAt(0)&&(b="{"+b.split(/\{(.+)?/)[1]);var d=a.parseJSON(b);"ERROR"===d.result?(e.find(".wc-appointments-appointment-cost").html(d.html),e.find(".wc-appointments-appointment-cost").unblock(),e.find(".single_add_to_cart_button").addClass("disabled")):"SUCCESS"===d.result?(e.find(".wc-appointments-appointment-cost").html(d.html),e.find(".wc-appointments-appointment-cost").unblock(),e.find(".wc-appointments-appointment-hook").show(),e.find(".single_add_to_cart_button").removeClass("disabled"),wc_appointment_form_params.is_admin||c.update_querystring_date_time(e)):(e.find(".wc-appointments-appointment-cost").hide(),e.find(".wc-appointments-appointment-hook").hide(),e.find(".single_add_to_cart_button").addClass("disabled"))},error:function(){e.find(".wc-appointments-appointment-cost").hide(),e.find(".single_add_to_cart_button").addClass("disabled")},dataType:"html"})}},update_querystring_date_time:function(a){if(window.history&&window.history.pushState){var b=a.find("input.appointment_date_year").val(),d=a.find("input.appointment_date_month").val(),e=a.find("input.appointment_date_day").val(),f=a.find("#wc_appointments_field_start_date"),g=a.find("#wc_appointments_field_staff"),h=b+"-"+d+"-"+e,i=window.location.href,j=c.replace_url_parameter("date",h,i),k=void 0!==f.attr("data-value")?f.attr("data-value"):"";k.length>0&&""!==k?(j=c.replace_url_parameter("time",f.attr("data-value"),j),window.history.replaceState({date:h,time:f.attr("data-value")},null,j)):window.history.replaceState({date:h,time:null},null,j),g.length>0&&""!==g.val()?(j=c.replace_url_parameter("staff",g.val(),j),window.history.replaceState({staff:g.val()},null,j)):(j=c.remove_url_parameter("staff",j),window.history.replaceState({staff:null},null,j))}},replace_url_parameter:function(a,b,c){var d=c.match(/[a-z\d]+=[a-z\d]+/gi),e=d?d.length:0;if(null===get_querystring(a))c+=(e>0?"&":"?")+a+"="+encodeURIComponent(b);else{var f=new RegExp("("+a+"=)[^&]+");c=c.replace(f,"$1"+encodeURIComponent(b))}return c},remove_url_parameter:function(a,b){var c=b.split("?")[0],d=[],e=-1!==b.indexOf("?")?b.split("?")[1]:"";if(""!==e){d=e.split("&");for(var f=d.length-1;f>=0;f-=1)d[f].split("=")[0]===a&&d.splice(f,1);c=c+"?"+d.join("&")}return c}};c.init()});